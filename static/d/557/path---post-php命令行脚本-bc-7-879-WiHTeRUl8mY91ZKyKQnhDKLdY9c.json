{"data":{"markdownRemark":{"html":"<h2>汤头</h2>\n<p>遇到一个问题:要把一个 git 库的 commit 重新拆分. 由于 git 的 commit 历史是不可以修改的.所以,可行方案只有 checkout 每个 commit 到一个单独的文件夹再做拆分.</p>\n<!--more-->\n<h2>解决方案</h2>\n<p>本来打算采用最简(fei)单(shi)方法, 手动操作(反正也就十几二十个 commit).</p>\n<p>在导师的建议下尝试用 PHP 写一个脚本来批量完成这个任务.</p>\n<h2>菜!菜!!</h2>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\">#!/usr/bin/php\n\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$log</span>  <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$state</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/*\n进入工作目录\n*/</span>\n<span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"cd ~/[path/to/git-repo] &amp;&amp; git log\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$log</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$state</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">/*编号*/</span>\n<span class=\"token comment\">/*\n@NOTE 小坑：linux换行必须使用**双引号**包裹字符串\n*/</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$log</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$log_item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"/^commit /\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$log_item</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$commit_id</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$log_item</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"checkout ... \"</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$commit_id</span> <span class=\"token punctuation\">.</span><span class=\"token double-quoted-string string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token operator\">++</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">/*\n        拼装命令\n        */</span>\n        <span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'cd ~/[path/to/git-repo] '</span>\n                <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">' &amp;&amp; git reset --hard '</span>\n                <span class=\"token punctuation\">.</span> <span class=\"token variable\">$commit_id</span>\n                <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;&amp; cd ../ &amp;&amp; cp -rf ./[git-repo] ./checkout-'</span>\n                <span class=\"token punctuation\">.</span> <span class=\"token variable\">$id</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'-'</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$commit_id</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">,</span> <span class=\"token variable\">$msg</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"[info]:\"</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$msg</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token double-quoted-string string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/*\n重置到最新的分支\n*/</span>\n<span class=\"token function\">exec</span><span class=\"token punctuation\">(</span> <span class=\"token single-quoted-string string\">'cd ~/[path/to/git-repo] &amp;&amp; git reset --hard '</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$log</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"[info]: 重置回默认版本号 \\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"over! and enjoy!! \\n\"</span><span class=\"token punctuation\">;</span>\n <span class=\"token delimiter important\">?></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"PHP命令行脚本","tags":["php","shell"]},"excerpt":"汤头 遇到一个问题:要把一个 git 库的 commit 重新拆分. 由于 git 的 commit 历史是不可以修改的.所以,可行方案只有 checkout 每个 commit 到一个单独的文件夹再做拆分. 解决方案 本来打算采用最简(fei)单(shi…"}},"pageContext":{"slug":"/post/PHP命令行脚本","pre":"/post/Nginx反向代理","next":"/post/C模拟实现类","tags":["wabpack","eslint","javascript","axios","api","react","babel","linix","app","algorihm","git","gogs","ruby","language","nginx","proxy","php","shell","cpp","language-feature","c","recursion","java","jsp","mysql","atom","markdown","nodejs","error"]}}