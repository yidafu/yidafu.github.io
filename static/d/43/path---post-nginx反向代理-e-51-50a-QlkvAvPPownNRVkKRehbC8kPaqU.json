{"data":{"markdownRemark":{"html":"<p>这里以部署一个<code class=\"language-text\">code-to-image</code>为例子，实例演示如何使用 Nginx 反向代理。</p>\n<h1>设置子域名</h1>\n<p>首先你的设置一个子域名和云解析，例如: code2img.domain.com</p>\n<blockquote>\n<p>code2img.test.com 只是为了演示，实际操作请换成你的域名。</p>\n</blockquote>\n<p>我使用的阿里云</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/35d298a524f5d248422d6cf7f6bb4232/69113/nginx-1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 181px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 250.27624309392266%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAyABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAgMB/9oADAMBAAIQAxAAAAHjmquQC0bRWOLQYxeJ2zWFwAf/xAAcEAACAQUBAAAAAAAAAAAAAAAAARECAxATICL/2gAIAQEAAQUCQ+YqPZFRuY7zNzw8RiOP/8QAGREAAgMBAAAAAAAAAAAAAAAAAxEAEFEg/9oACAEDAQE/AaZMjJnP/8QAGBEAAgMAAAAAAAAAAAAAAAAAABAgISL/2gAIAQIBAT8BVGY//8QAHBAAAgICAwAAAAAAAAAAAAAAADEBQREgEDKR/9oACAEBAAY/Alk641vwsUkIoRXKFr//xAAhEAABAwMEAwAAAAAAAAAAAAABABEhEDFhUXGB8SCRof/aAAgBAQABPyECUWfR6BtDwjgHmgA1sSm1euUuH0tAawUJIhL7AbUDmZ8Jh2TvD//aAAwDAQACAAMAAAAQuCtORxCC/8QAGBEAAgMAAAAAAAAAAAAAAAAAYZEAECD/2gAIAQMBAT8Qodwd5//EABgRAAIDAAAAAAAAAAAAAAAAABFRABAg/9oACAECAQE/EKDwNn//xAAhEAEAAgEEAQUAAAAAAAAAAAABESEAEDFRcUEgYYGR8f/aAAgBAQABPxBin8nKzlLaRycKGVcEo9zopATsKnjETN3ToQoI8mfLZwIfQWs/dcKASvKE94EM0ttujqTCDC284xJEYiZU50ej/9k='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx 1\"\n        title=\"\"\n        src=\"/static/35d298a524f5d248422d6cf7f6bb4232/69113/nginx-1.jpg\"\n        srcset=\"/static/35d298a524f5d248422d6cf7f6bb4232/7cc83/nginx-1.jpg 163w,\n/static/35d298a524f5d248422d6cf7f6bb4232/69113/nginx-1.jpg 181w\"\n        sizes=\"(max-width: 181px) 100vw, 181px\"\n      />\n  </span>\n  </a></p>\n<p>点击添加云解析</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/304190a84c3cc206d94ebfa4a27b376e/1c665/nginx-2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 650px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 4.454486765655261%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAABABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAd2QKgVl/8QAFhAAAwAAAAAAAAAAAAAAAAAAAhAx/9oACAEBAAEFAkV//8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQMBAT8BV//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABcQAAMBAAAAAAAAAAAAAAAAAAABMRD/2gAIAQEAAT8hVeVP/9oADAMBAAIAAwAAABD7/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QjVf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQIBAT8QqY//xAAYEAACAwAAAAAAAAAAAAAAAAAAsQEQof/aAAgBAQABPxDJFJI//9k='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx 2\"\n        title=\"\"\n        src=\"/static/304190a84c3cc206d94ebfa4a27b376e/b80fa/nginx-2.jpg\"\n        srcset=\"/static/304190a84c3cc206d94ebfa4a27b376e/cf410/nginx-2.jpg 163w,\n/static/304190a84c3cc206d94ebfa4a27b376e/62f2a/nginx-2.jpg 325w,\n/static/304190a84c3cc206d94ebfa4a27b376e/b80fa/nginx-2.jpg 650w,\n/static/304190a84c3cc206d94ebfa4a27b376e/08cb4/nginx-2.jpg 975w,\n/static/304190a84c3cc206d94ebfa4a27b376e/f2bf9/nginx-2.jpg 1300w,\n/static/304190a84c3cc206d94ebfa4a27b376e/1c665/nginx-2.jpg 1549w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>在主机记录输入子域名名。</p>\n<p>记录值填入云服务器 IP 地址。</p>\n<p>其余一般默认即可，点击确认。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2e837614aa72ea6bc0b6bce0807ed28b/e0fe5/nginx-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 650px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.945872801082544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABC0lEQVQoz5WSQW6EMAxFuWtv02v1Bt112Q2rKZCEJE5iO/0EEWaYqmqfImOQP/42DG5dx3GMMaoK4FKEGdctMuP2cjo550FVkSEmQCmL+lR8ypE55EKiSY8jEllQWRtIhnpgrLXGEsvk/bSulghJYI7QtENaPcT15BT7Bpz6EEKM8LG/Xo4zz7MxZn9+FVuH8VeMgEjxpI1DmGiLKaHgWazLYiDHGmCfiOACiXMOPnZTUObGD51Tk8E2uqG0MPfF9KTnVzH8YEGI6IYm22dryB33nh/EqINDRJjN21b0me1lWvvGh/oIKmAbs3bbvzDU/4Ceb0t8d6kQfgj5q3h3mkRfPm6vn5P7umHB35c2weWsNFVPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx 3\"\n        title=\"\"\n        src=\"/static/2e837614aa72ea6bc0b6bce0807ed28b/10273/nginx-3.png\"\n        srcset=\"/static/2e837614aa72ea6bc0b6bce0807ed28b/9b14a/nginx-3.png 163w,\n/static/2e837614aa72ea6bc0b6bce0807ed28b/94962/nginx-3.png 325w,\n/static/2e837614aa72ea6bc0b6bce0807ed28b/10273/nginx-3.png 650w,\n/static/2e837614aa72ea6bc0b6bce0807ed28b/e0fe5/nginx-3.png 739w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>一个子域名添加完成。</p>\n<h1>Nginx 代理</h1>\n<p>这里我使用的 LNMP。添加一个子域名就非常简单。</p>\n<p>执行</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">lnpm vhost add</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>所有选项全部默认就行。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d88cef020103eeb755b796a69fe7a0ea/a22ac/nginx-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 650px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 80.21760633036598%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABWklEQVQoz41TCW7EIAzMd2JDAhgwR65t//+n2sluq0pVN2iELNB4jD0MyBEjYSKMAcnLbtxkEM2NNcCxwFqxMzaGkg0F9A7dfIs85jiWPNasQY4wTcZavbkhPsRMVJk6E0ciH90sVBUnb+bpDZkfS95b3nt5rGVr3Jl7mXPES/9/cn8s9eh1a7GxrzmU5GsS5Vtv7kcve2t7I04+Bk8+BOffFfwkH1vbtrqvjWuONeeSUqb5u23/k22kKQYr45UOee2WNXfXMB7LuPfxsYxrhZLUKvJg5+5MS8lwdNga1AxNwBIgJ8xRRwWoKf7ARf7cxg8xWRNlFZcUYpVEcNlWDPey7RNyEk4LWDvA3tWbS1E02av4VOPzEAS9aDlyWFm/QPB4WljJuFbT2SzFZLLkrXc2ODtNCk1vflULL5ztOMveO6SoJUlWN+uvkKsLb36VtGptOieAH4V76wtBwrFJ4svOAwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"nginx 4\"\n        title=\"\"\n        src=\"/static/d88cef020103eeb755b796a69fe7a0ea/10273/nginx-4.png\"\n        srcset=\"/static/d88cef020103eeb755b796a69fe7a0ea/9b14a/nginx-4.png 163w,\n/static/d88cef020103eeb755b796a69fe7a0ea/94962/nginx-4.png 325w,\n/static/d88cef020103eeb755b796a69fe7a0ea/10273/nginx-4.png 650w,\n/static/d88cef020103eeb755b796a69fe7a0ea/2fc6f/nginx-4.png 975w,\n/static/d88cef020103eeb755b796a69fe7a0ea/a22ac/nginx-4.png 1011w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>进入<code class=\"language-text\">/usr/local/nginx/conf/vhost</code>目录</p>\n<p>将<code class=\"language-text\">code2img.test.com.conf</code>改为一下内容</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-conf line-numbers\"><code class=\"language-conf\">upstream dome {\n        server 127.0.0.1:8080;\n}\nserver\n    {\n        listen 80;\n        #listen [::]:80;\n        server_name code2.img.test.com ;\n        index index.html index.htm index.php default.html default.htm default.php;\n        root  /home/wwwroot/code2.img.test.com;\n\n        location / {\n            proxy_pass http://127.0.0.1:8080/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwaraed-For $proxy_add_x_forwarded_for;\n        }\n\n        include none.conf;\n        #error_page   404   /404.html;\n\n        # Deny access to PHP files in specific directory\n        #location ~ /(wp-content|uploads|wp-includes|images)/.*\\.php$ { deny all; }\n\n        include enable-php.conf;\n\n        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$\n        {\n            proxy_pass http://127.0.0.1:8080;\n            expires      30d;\n        }\n\n        location ~ .*\\.(js|css)$\n        {\n            proxy_pass http://127.0.0.1:8080;\n            expires      12h;\n        }\n\n        location ~ /.well-known {\n            allow all;\n        }\n\n        location ~ /\\.\n        {\n            deny all;\n        }\n\n        access_log  /home/wwwlogs/code2.img.test.com.log;\n    }</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后重启 LNMP 就可以了。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">lnmp restart</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>现在访问<a href=\"https://code2img.test.com\">https://code2img.test.com</a>就可以使用<code class=\"language-text\">code-to-img</code>了。</p>\n<p> 参考</p>\n<ul>\n<li><a href=\"http://www.nginx.cn/927.html\">http://www.nginx.cn/927.html</a></li>\n<li><a href=\"https://lnmp.org/faq/lnmp-vhost-add-howto.html\">LNMP 添加虚拟主机</a></li>\n</ul>","frontmatter":{"title":"Nginx 反向代理","tags":["Nginx","proxy"]},"excerpt":"这里以部署一个 为例子，实例演示如何使用 Nginx 反向代理。 设置子域名 首先你的设置一个子域名和云解析，例如: code2img.domain.com code2img.test.com…"}},"pageContext":{"slug":"/post/Nginx反向代理","pre":"/post/基于gogs的自主git服务","next":"/post/why-dont-choice-ruby","tags":["wabpack","eslint","react","babel","javascript","algorihm","linix","app","git","gogs","nginx","proxy","ruby","language","php","shell","cpp","language-feature","c","recursion","java","jsp","mysql","atom","markdown","nodejs","error"]}}